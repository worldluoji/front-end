# overrides
`npm` 的 `overrides` 是 npm 7.x 及以上版本引入的一个功能，用于在项目中强制指定依赖包的版本。它的主要作用是解决依赖冲突问题，尤其是在项目中存在多个依赖包对同一个子依赖包有不同版本要求时。

---

### 1. **`overrides` 的作用**
`overrides` 允许你在 `package.json` 中强制指定某个依赖包（包括嵌套依赖）的版本。它可以覆盖项目中所有依赖包的版本要求，确保使用你指定的版本。

---

### 2. **`overrides` 的使用场景**
- **解决依赖冲突**：当多个依赖包对同一个子依赖包有不同版本要求时，可以使用 `overrides` 强制指定一个统一的版本。
- **修复漏洞**：当某个子依赖包存在安全漏洞时，可以通过 `overrides` 强制升级到修复漏洞的版本。
- **测试新版本**：在项目中测试某个依赖包的新版本，而无需修改所有依赖包的 `package.json`。

---

### 3. **`overrides` 的语法**
在 `package.json` 中，`overrides` 是一个对象，键是依赖包的名称，值是你希望强制指定的版本。

#### 基本语法：
```json
{
  "overrides": {
    "依赖包名称": "版本"
  }
}
```

#### 嵌套依赖语法：
如果需要对某个依赖包的子依赖包进行覆盖，可以使用嵌套语法：
```json
{
  "overrides": {
    "父依赖包名称": {
      "子依赖包名称": "版本"
    }
  }
}
```

---

### 4. **示例**

#### 示例 1：覆盖直接依赖
假设你希望强制将 `lodash` 的版本锁定为 `4.17.21`，可以在 `package.json` 中添加：

```json
{
  "overrides": {
    "lodash": "4.17.21"
  }
}
```

#### 示例 2：覆盖嵌套依赖
假设 `alipay-sdk` 依赖了 `undici` 7.x，而你需要将 `undici` 降级到 6.x，可以在 `package.json` 中添加：

```json
{
  "overrides": {
    "alipay-sdk": {
      "undici": "6.x"
    }
  }
}
```

#### 示例 3：覆盖所有依赖中的某个包
假设你希望项目中所有依赖包都使用 `undici` 6.x 版本，可以在 `package.json` 中添加：

```json
{
  "overrides": {
    "undici": "6.x"
  }
}
```

---

### 5. **`overrides` 的工作原理**
- 当你运行 `npm install` 时，npm 会读取 `overrides` 字段，并强制将所有匹配的依赖包替换为你指定的版本。
- `overrides` 会覆盖项目中所有依赖包的版本要求，包括直接依赖和嵌套依赖。

---

### 6. **注意事项**
- **npm 版本要求**：`overrides` 是 npm 7.x 及以上版本的功能。如果你使用的是 npm 6.x 或更低版本，需要升级 npm：

  ```bash
  npm install -g npm@latest
  ```

- **谨慎使用**：`overrides` 会强制覆盖依赖包的版本，可能会导致某些依赖包不兼容。在使用前，请确保测试覆盖后的版本是否正常工作。
- **与 `resolutions` 的区别**：`overrides` 是 npm 的功能，而 `resolutions` 是 Yarn 的功能。两者的作用类似，但语法和实现方式不同。

---

### 7. **与 `resolutions` 的对比**
如果你熟悉 Yarn 的 `resolutions`，`overrides` 的功能与之类似。以下是两者的对比：

| 功能         | npm (`overrides`)                  | Yarn (`resolutions`)               |
|--------------|-----------------------------------|------------------------------------|
| 语法         | 嵌套对象                          | 扁平对象                           |
| 覆盖范围     | 所有依赖包                        | 所有依赖包                         |
| 版本要求     | npm 7.x 及以上                    | Yarn 1.x 及以上                    |
| 示例         | `"overrides": { "lodash": "4.17.21" }` | `"resolutions": { "lodash": "4.17.21" }` |

---

### 8. **总结**
- `overrides` 是 npm 7.x 及以上版本的功能，用于强制指定依赖包的版本。
- 它可以解决依赖冲突、修复漏洞或测试新版本。
- 语法简单，支持嵌套依赖的覆盖。
- 使用时需谨慎，确保覆盖后的版本兼容。
