# hooks
## 自定义Hooks最佳实践

为了确保自定义Hooks的高效性、可维护性和可靠性，以下是优化后的一系列指导原则：

1. **无状态设计**
   - **避免内部状态**：不要在自定义Hooks内部创建状态（如使用`ref`或`reactive`），除非这些状态是公开给使用者API的一部分。保持Hooks无状态，减少不必要的复杂度。

2. **副作用管理**
   - **生命周期钩子**：将副作用（例如API调用、定时器等）放在适当的生命周期钩子中（如`onMounted`、`onUnmounted`）。不在参数处理或逻辑中直接执行副作用，以保证代码清晰和可预测。

3. **减少外部依赖**
   - **最小化依赖**：尽量减少自定义Hooks对外部状态的依赖。如果需要依赖外部状态，确保通过参数传递，而不是直接访问组件的状态或其他全局状态。

4. **增强鲁棒性**
   - **参数验证**：添加参数验证逻辑，确保自定义Hooks能够处理无效或意外的参数，提高代码的鲁棒性。

5. **稳定API选择**
   - **避免不稳定API**：始终查阅官方文档，选择那些稳定且不会在未来版本中更改或删除的API。

6. **性能优化**
   - **避免昂贵操作**：防止在自定义Hooks中执行深度比较或复杂的计算等昂贵操作，以免影响组件的渲染性能。
   - **控制重渲染**：确保Hooks不会由于响应式依赖不当而导致不必要的组件重渲染。

7. **一致性命名**
   - **遵循命名规范**：采用一致的命名约定，通常是以`use`为前缀，便于识别和使用。

8. **简洁直观**
   - **避免过度封装**：保持Hooks简单和直观，避免创建过于通用或复杂的Hooks，这有助于理解和维护。

9. **错误处理**
   - **妥善处理错误**：确保自定义Hooks能妥善处理各种错误情况，比如API请求失败或无效输入。

10. **合理使用生命周期**
    - **谨慎使用钩子**：不要滥用生命周期钩子，只在必要时使用它们。

11. **单向数据流**
    - **遵守数据流动规则**：确保Hooks遵循框架的单向数据流原则，避免创建可能导致数据流混乱的逻辑。

12. **类型安全**
    - **严格类型检查**：在使用TypeScript编写Hooks时，确保进行了适当的类型检查和推断，以提升开发体验和代码质量。

13. **正确使用响应式API**
    - **选用合适的响应式工具**：根据需求选择正确的响应式API（如`ref` vs `reactive`），并在应该使用不可变对象的地方应用`readonly`。

14. **全局状态管理**
    - **妥善管理全局状态**：如果Hooks依赖于全局状态，确保其正确处理，以避免状态管理上的混乱。


---

## 何时应抽取为自定义 Hooks？

在以下几种场景下，抽取为自定义 Hooks 是一个明智的选择：

1. **逻辑复用**
   - **提高代码复用性**：当多个组件中存在相同或相似的逻辑时，将这些逻辑抽取为自定义 Hooks 可以显著减少重复代码。例如，在多个页面组件中都需要从服务器获取用户信息并管理加载和错误状态，可以创建`useFetchUser` Hook，让各个组件通过调用此 Hook 来实现数据获取与状态管理。

2. **封装复杂业务逻辑**
   - **增强代码清晰度和可维护性**：对于包含复杂业务逻辑的组件（如表单验证、数据提交、错误处理等），将其分解为独立的 Hooks（如`useFormValidation`、`useSubmitForm`、`useFormErrorHandling`）有助于简化主组件逻辑，使其更专注于UI展示，同时使业务逻辑更加模块化和易于测试。

3. **特定功能的抽象**
   - **促进功能模块化**：当某些特定功能需要跨多个组件使用时，可以通过自定义 Hooks 进行抽象。比如，实现主题切换功能时，可以将管理当前主题状态、切换方法及保存设置到本地存储等逻辑封装进`useTheme` Hook，从而方便地在任何需要的地方调用。

4. **提升测试便利性**
   - **改善单元测试体验**：如果某些逻辑在组件内部难以单独测试，尤其是那些与生命周期紧密耦合的部分（如定时器逻辑），可以考虑将其抽取为独立的 Hooks（如`useTimer`）。这样做不仅提高了测试的便捷性和准确性，还降低了测试环境搭建的复杂度。

5. **优化性能**
   - **减少不必要的重渲染**：通过合理设计自定义 Hooks，可以避免因不必要依赖导致的组件频繁重渲染，从而优化应用性能。

6. **遵循单一职责原则**
   - **保持组件职责单一**：确保每个组件只负责其自身的UI逻辑，而复杂的业务逻辑或副作用则由专门的 Hooks 处理，这有助于构建更简洁、更易理解的代码库。

---

## hooks工具库: vueuse和vue-hooks-plus
对于常用的hooks方法可以单独抽取进行发包成hooks工具。在业务开发中常用的vue hooks方法库有：vueuse和vue-hooks-plus。


## reference
https://juejin.cn/post/7401412571095433225