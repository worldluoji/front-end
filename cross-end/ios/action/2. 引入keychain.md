# 引入keychain
要在你的Swift项目中引入第三方库如`KeychainSwift`，你可以使用CocoaPods、Swift Package Manager或Carthage。这里我将向你展示如何使用最流行的两种方式：CocoaPods和Swift Package Manager。

### 使用CocoaPods

1. **安装CocoaPods**（如果你还没有安装的话）:
   打开终端并运行以下命令来安装CocoaPods：
   ```bash
   brew install cocoapods
   ```

2. **创建Podfile**:
   在你的Xcode项目的根目录下创建一个名为`Podfile`的文件，并添加如下内容：
   ```ruby
   platform :ios, '14.0'  # 根据你的项目支持的iOS版本进行调整
   use_frameworks!

   target 'YourProjectName' do
     pod 'KeychainSwift'
   end
   ```

3. **安装依赖**:
   在终端中进入包含`Podfile`的目录，然后运行：
   ```bash
   pod install
   ```
   这将会下载并安装`KeychainSwift`以及它的依赖项。完成后，请确保通过`.xcworkspace`文件打开项目，而不是原来的`.xcodeproj`文件。

### 使用Swift Package Manager

1. **在Xcode中打开你的项目**。

2. **添加包依赖**:
   - 选择`File` -> `Add Packages...`
   - 在搜索栏输入`KeychainSwift`的GitHub仓库地址: `https://github.com/evgenyneu/keychain-swift`
   - 选择适当的版本后点击`Next`。
   - 选择你的目标应用，然后点击`Finish`。

### 在代码中导入KeychainSwift

无论你是使用CocoaPods还是Swift Package Manager，一旦成功安装了`KeychainSwift`，你就可以在需要使用的地方导入它：

```swift
import KeychainSwift
```

接着，你就可以按照之前提到的方法来使用`KeychainSwift`保存和加载token了。

### 示例代码

```swift
import KeychainSwift

let keychain = KeychainSwift()

func saveToken(_ token: String) {
    keychain.set(token, forKey: "UserToken")
}

func loadToken() -> String? {
    return keychain.get("UserToken")
}
```

这样，你就完成了在Swift项目中集成`KeychainSwift`库的过程，并且可以开始安全地存储敏感信息如认证令牌了。

<br>

## token超时时间
`KeychainSwift`库本身并不直接提供设置token超时时间的功能。Keychain是iOS提供的一个安全存储机制，用于保存敏感信息如密码、令牌等，但它不支持为存储的项目设置自动过期时间。

如果你需要实现token的超时功能，通常的做法是在应用层面进行管理。这里有几个可能的方法来实现：

1. **本地时间戳**：
   - 当你从服务器接收到token时，同时记录下当前的时间戳。
   - 每次使用token之前，检查这个时间戳是否超过了设定的有效期（比如1小时）。
   - 如果超过有效期，则认为token已过期，需要重新登录或刷新token。

2. **服务器返回的过期时间**：
   - 服务器在返回token的同时，可以返回一个过期时间或者有效期限。
   - 在客户端存储这个过期时间，并在每次使用token前进行校验。

3. **定时任务**：
   - 使用`DispatchSourceTimer`或者其他定时器API，在后台定期检查token的有效性。
   - 如果token即将过期，可以在用户操作之前尝试刷新token，或者提示用户重新登录。

### 示例代码：使用本地时间戳

```swift
import KeychainSwift

let keychain = KeychainSwift()

// 保存token和过期时间
func saveToken(_ token: String, expirationInterval: TimeInterval) {
    // 保存token
    keychain.set(token, forKey: "UserToken")
    
    // 计算过期时间
    let expirationDate = Date().addingTimeInterval(expirationInterval)
    // 保存过期时间
    UserDefaults.standard.set(expirationDate, forKey: "TokenExpiration")
}

// 加载token并检查是否过期
func loadAndCheckToken() -> String? {
    guard let token = keychain.get("UserToken"),
          let expirationDate = UserDefaults.standard.object(forKey: "TokenExpiration") as? Date,
          expirationDate > Date() else {
        // Token不存在或已过期
        return nil
    }
    
    return token
}
```

在这个示例中，`saveToken(_:expirationInterval:)`函数将token及其过期时间一并保存。`loadAndCheckToken()`函数则会检查token是否仍然有效。如果token已经过期，它将返回`nil`，表示你需要处理过期的情况（例如，要求用户重新登录）。